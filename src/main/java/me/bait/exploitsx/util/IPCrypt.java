package me.bait.exploitsx.util;

import me.bait.exploitsx.ExploitsX;
import org.bukkit.Bukkit;
import org.bukkit.configuration.InvalidConfigurationException;
import org.bukkit.configuration.file.YamlConfiguration;
import org.bukkit.entity.Player;
import org.bukkit.scheduler.BukkitRunnable;

import java.io.File;
import java.io.IOException;

public class IPCrypt {
    private IPCrypt() {
    }

    public static void quit(Player p) {
        new Thread(() -> new BukkitRunnable() {
            @Override
            public void run() {
                String uuid = p.getUniqueId().toString();

                if (ExploitsX.getPlugin().getConfig().getBoolean("debug")) {
                    Bukkit.getLogger().info("ExploitsX is recycling the IP of: " + p + " for security purposes.");
                }

                File dir = new File("plugins/Essentials/userdata/");

                if (dir.exists()) {
                    File f = new File("plugins/Essentials/userdata/" + uuid + ".yml");
                    if (f.exists()) {
                        YamlConfiguration save = new YamlConfiguration();
                        try {
                            save.load(f);
                        } catch (IOException | InvalidConfigurationException er) {
                            er.printStackTrace();
                        }

                        save.set("ipAddress", "127.0.0.1");
                        try {
                            save.save(f);
                        } catch (IOException er) {
                            er.printStackTrace();
                        }
                    }
                }
            }
        }.runTaskLater(ExploitsX.getPlugin(), 10)).start(); // run later in case of lag causing Essentials to take longer to save the file
    }
}
