package me.bait.exploitsx.gameplay;

import me.bait.exploitsx.util.ConfigHelper;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.CreatureSpawnEvent;

public class Spawner implements Listener {
    private static final double rad = 32.0;
    private static int maxmobs = ConfigHelper.getInt("spawners.maxmobs");
    private static int patch = ConfigHelper.getInt("spawners.patch");

    public static void reload() {
        maxmobs = ConfigHelper.getInt("spawners.maxmobs");
        patch = ConfigHelper.getInt("spawners.patch");
    }

    @EventHandler
    public void entitySpawnEvent(CreatureSpawnEvent event) {
        CreatureSpawnEvent.SpawnReason r = event.getSpawnReason();
        if (patch != 0) {
            String[] keys = {"skeleton", "zombie", "blaze", "spider", "silverfish", "magma", "pig"};
            if (patch == 2) keys = new String[]{"skeleton", "zombie", "blaze", "spider", "silverfish", "magma"};
            if ((r == CreatureSpawnEvent.SpawnReason.SPAWNER || r == CreatureSpawnEvent.SpawnReason.SPAWNER_EGG)) {
                for (String i : keys) {
                    if (!event.getEntityType().toString().toLowerCase().contains(i)) {
                        event.setCancelled(true);
                    }
                }
            }
            if ((r == CreatureSpawnEvent.SpawnReason.SPAWNER || r == CreatureSpawnEvent.SpawnReason.SPAWNER_EGG) && event.getEntity().getNearbyEntities(rad, 256, rad).size() > maxmobs) {
                event.setCancelled(true);
            }
        }
    }
}
