package me.bait.exploitsx.gameplay;

import me.bait.exploitsx.ExploitsX;
import me.bait.exploitsx.util.ConfigHelper;
import net.md_5.bungee.api.ChatColor;
import org.bukkit.Bukkit;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerJoinEvent;
import org.bukkit.event.player.PlayerQuitEvent;

public class JoinLeave implements Listener {

    public static void onJoin(PlayerJoinEvent event) {
        Player p = event.getPlayer();
        if (ConfigHelper.getBoolean("enablejoinleavemsg")) {
            if (Bukkit.getOnlinePlayers().size() > ConfigHelper.getInt("joinleavemsgdisable", 35)) {
                event.setJoinMessage(null);
            } else {
                event.setJoinMessage(
                        ChatColor.translateAlternateColorCodes('&', "&7" + event.getPlayer().getName() + " joined"));
            }
        }
    }

    @EventHandler
    public void onLeave(PlayerQuitEvent event) {
        if (ConfigHelper.getBoolean("enablejoinleavemsg")) {
            if (Bukkit.getOnlinePlayers().size() > ConfigHelper.getInt("joinleavemsgdisable", 35)) {
                event.setQuitMessage(null);
            } else {
                event.setQuitMessage(
                        ChatColor.translateAlternateColorCodes('&', "&7" + event.getPlayer().getName() + " left"));
            }
        }
    }
    /*
    // TODO fix these up for 1.8

    # Use {PLAYER} and {TOTALJOINS} as placeholders. PlaceholderAPI support coming soon.
    #   {TJFORMAT} will add "st", "nd" or "th" respective to the number before it
        firstjoin:
          enable: false
          removeactualjoinmsg: true
          firstjoinmsg: "&c{PLAYER}&r&7 Has joined the server for the first time! They are the {TOTALJOINS}{TJFORMAT} player!"
    # Allow players to use the /say command.
    # Use {PREFIX} For ExploitsX prefix, {PLAYER} for the playername and {MESSAGE} for the message.*/


    // TODO REPLACE VARIABLES
    // TODO SOCIALSPY
    @EventHandler
    public static void firstJoin(PlayerJoinEvent event) {
        if (ConfigHelper.getBoolean("firstjoin.enable", false)) {
            if (RegisterStats.onJoin(event)) {
                ExploitsX.getPlugin().getServer().broadcastMessage(ChatColor.translateAlternateColorCodes('&', ConfigHelper.getString("firstjoin.firstjoinmsg")));
            }
            if (ConfigHelper.getBoolean("firstjoin.removeactualjoinmsg", false))
                return;
        }
        onJoin(event);
    }
}
